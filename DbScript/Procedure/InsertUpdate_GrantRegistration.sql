IF EXISTS(SELECT * FROM INFORMATION_SCHEMA.ROUTINES WHERE ROUTINE_NAME = 'InsertUpdate_GrantRegistration')
DROP PROCEDURE InsertUpdate_GrantRegistration
GO 
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
CREATE PROCEDURE [dbo].[InsertUpdate_GrantRegistration]   
   @GrantRegistrationId VARCHAR(50)
  ,@GrantApprovalId VARCHAR(50)
  ,@ExercisePrice NUMERIC
  ,@MerchantCode VARCHAR(50)
  ,@IsSAR CHAR(1)
  ,@IsPerformanceBased CHAR(1)
  ,@USERID INT
  ,@VERSION INT  = 1
AS
BEGIN
IF NOT EXISTS(SELECT 1 FROM tblGrantRegistration WHERE GrantRegistrationId = @GrantRegistrationId)
BEGIN 

INSERT INTO [dbo].[tblGrantRegistration]   
  (GrantRegistrationId
  ,GrantApprovalId
  ,ExercisePrice
  ,MerchantCode
  ,IsSAR
  ,IsPerformanceBased
  ,ADD_USERID
  ,ADD_TIMESTAMP
  ,[VERSION]
 )
VALUES(   
   @GrantRegistrationId
  ,@GrantApprovalId
  ,@ExercisePrice
  ,@MerchantCode
  ,@IsSAR
  ,@IsPerformanceBased
  ,@USERID
  ,GETDATE()
  ,1
)
END 

IF EXISTS(SELECT 1 FROM tblGrantRegistration WHERE GrantRegistrationId = @GrantRegistrationId)
BEGIN 
UPDATE tblGrantRegistration SET
   UPDATE_USERID = @USERID
  ,UPDATE_TIMESTAMP = GETDATE()
  ,VERSION = @VERSION 
  ,GrantApprovalId = @GrantApprovalId 
  ,ExercisePrice = @ExercisePrice 
  ,MerchantCode = @MerchantCode 
  ,IsSAR = @IsSAR 
  ,IsPerformanceBased = @IsPerformanceBased 
  WHERE GrantRegistrationId = @GrantRegistrationId
END 

END 
